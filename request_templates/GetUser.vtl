#set ($tenant = $!{ctx.identity.claims.tenant})

#if ("$!{ctx.identity.username}" != "$!{ctx.args.email}" && "$!{ctx.identity.claims.role}" != "admin")
  $util.error("Unauthorized")
#end

{
  "version": "2017-02-28",
  "operation": "Query",
  "query": {
    expression: ":pk = :tenant AND sk = :sk",
    expressionValues: {
      ":tenant": $util.dynamodb.toDynamoDBJson("$tenant"),
      ":sk": $util.dynamodb.toDynamoDBJson("U~$!{ctx.args.email}")
    }
  }
}
